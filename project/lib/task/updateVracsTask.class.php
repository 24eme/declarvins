<?php

class updateVracsTask extends sfBaseTask {

    protected function configure() {
        $this->addOptions(array(
            new sfCommandOption('application', null, sfCommandOption::PARAMETER_REQUIRED, 'The application name'),
            new sfCommandOption('env', null, sfCommandOption::PARAMETER_REQUIRED, 'The environment', 'dev'),
            new sfCommandOption('connection', null, sfCommandOption::PARAMETER_REQUIRED, 'The connection name', 'default'),
                // add your own options here
        ));

        $this->namespace = 'update';
        $this->name = 'vracs';
        $this->briefDescription = '';
        $this->detailedDescription = <<<EOF
The [update|INFO] task does things.
Call it with:
  [php symfony update|INFO]
EOF;
    }

    protected function execute($arguments = array(), $options = array()) {
        ini_set('memory_limit', '512M');
        set_time_limit('3600');
        // initialize the database connection
        $databaseManager = new sfDatabaseManager($this->configuration);
        $connection = $databaseManager->getDatabase($options['connection'])->getConnection();
        
        $vracs = array(
        "VRAC-20150116038",
"VRAC-20150116039",
"VRAC-20150116043",
"VRAC-20150116045",
"VRAC-20150116046",
"VRAC-20150116048",
"VRAC-20150116050",
"VRAC-20150116058",
"VRAC-20150116061",
"VRAC-20150116062",
"VRAC-20141222044",
"VRAC-20141222049",
"VRAC-20141222090",
"VRAC-20141222092",
"VRAC-20141222093",
"VRAC-20141222095",
"VRAC-20150115010",
"VRAC-20141222107",
"VRAC-20141222109",
"VRAC-20141222110",
"VRAC-20141222111",
"VRAC-20141222113",
"VRAC-20141222115",
"VRAC-20141222116",
"VRAC-20141222009",
"VRAC-20141222010",
"VRAC-20141222011",
"VRAC-20141222012",
"VRAC-20141222013",
"VRAC-20141222014",
"VRAC-20141222015",
"VRAC-20141222017",
"VRAC-20141222018",
"VRAC-20141222024",
"VRAC-20141222028",
"VRAC-20141222029",
"VRAC-20141222030",
"VRAC-20141222031",
"VRAC-20141222032",
"VRAC-20141222033",
"VRAC-20141222034",
"VRAC-20141222036",
"VRAC-20150123056",
"VRAC-20150123057",
"VRAC-20150115011",
"VRAC-20150115013",
"VRAC-20150119161",
"VRAC-20150119164",
"VRAC-20150119166",
"VRAC-20150119169",
"VRAC-20150119172",
"VRAC-20150119173",
"VRAC-20150119175",
"VRAC-20150119176",
"VRAC-20150119177",
"VRAC-20150119178",
"VRAC-20150119179",
"VRAC-20150119180",
"VRAC-20150119181",
"VRAC-20150120040",
"VRAC-20150120044",
"VRAC-20150120048",
"VRAC-20150120049",
"VRAC-20150120051",
"VRAC-20141219075",
"VRAC-20141219077",
"VRAC-20141219078",
"VRAC-20141219079",
"VRAC-20141219080",
"VRAC-20141219081",
"VRAC-20141219083",
"VRAC-20141219084",
"VRAC-20150115014",
"VRAC-20150115017",
"VRAC-20150115018",
"VRAC-20150115021",
"VRAC-20150115023",
"VRAC-20150115025",
"VRAC-20150115026",
"VRAC-20150115027",
"VRAC-20141223061",
"VRAC-20141223062",
"VRAC-20141223063",
"VRAC-20141223064",
"VRAC-20141223066",
"VRAC-20141223003",
"VRAC-20141223030",
"VRAC-20141223033",
"VRAC-20150121061",
"VRAC-20150121063",
"VRAC-20150121064",
"VRAC-20150121067",
"VRAC-20150121070",
"VRAC-20150119038",
"VRAC-20150119041",
"VRAC-20150119044",
"VRAC-20150119046",
"VRAC-20150119048",
"VRAC-20141219020",
"VRAC-20141219024",
"VRAC-20141219026",
"VRAC-20141219027",
"VRAC-20141219028",
"VRAC-20141219029",
"VRAC-20141219032",
"VRAC-20141219033",
"VRAC-20141219034",
"VRAC-20141219036",
"VRAC-20141219037",
"VRAC-20141222123",
"VRAC-20141222124",
"VRAC-20141222125",
"VRAC-20141222126",
"VRAC-20141222127",
"VRAC-20141222128",
"VRAC-20141222129",
"VRAC-20141223052",
"VRAC-20141223053",
"VRAC-20141223054",
"VRAC-20141223055",
"VRAC-20141219074",
"VRAC-20150122047",
"VRAC-20150122048",
"VRAC-20150122049",
"VRAC-20150122050",
"VRAC-20150122052",
"VRAC-20150122054",
"VRAC-20141222117",
"VRAC-20141222119",
"VRAC-20141222120",
"VRAC-20141222122",
"VRAC-20141219066",
"VRAC-20141219067",
"VRAC-20141219068",
"VRAC-20141219069",
"VRAC-20141219070",
"VRAC-20150116104",
"VRAC-20150116105",
"VRAC-20150116106",
"VRAC-20150123020",
"VRAC-20150123028",
"VRAC-20150123029",
"VRAC-20141219046",
"VRAC-20150119104",
"VRAC-20150119109",
"VRAC-20150119111",
"VRAC-20150119114",
"VRAC-20150119115",
"VRAC-20150119117",
"VRAC-20150119118",
"VRAC-20141223060",
"VRAC-20141219065",
"VRAC-20141219048",
"VRAC-20141219053",
"VRAC-20141219059",
"VRAC-20141222037",
"VRAC-20141222040",
"VRAC-20150116086",
"VRAC-20150116087",
"VRAC-20150116088",
"VRAC-20141223090",
"VRAC-20141222097",
"VRAC-20141223050",
"VRAC-20141223051",
"VRAC-20141223047",
"VRAC-20141223048",
"VRAC-20141223081",
"VRAC-20141223082",
"VRAC-20141223083",
"VRAC-20141223084",
"VRAC-20141223085",
"VRAC-20141223086",
"VRAC-20141223087",
"VRAC-20141223088",
"VRAC-20141223089",
"VRAC-20150119062",
"VRAC-20150119072",
"VRAC-20150119075",
"VRAC-20150119077",
"VRAC-20150116090",
"VRAC-20150116091",
"VRAC-20150116093",
"VRAC-20150116094",
"VRAC-20150116095",
"VRAC-20150116096",
"VRAC-20150116097",
"VRAC-20150116098",
"VRAC-20150116099",
"VRAC-20150116101",
"VRAC-20150116102",
"VRAC-20141222019",
"VRAC-20141222020",
"VRAC-20141222021",
"VRAC-20141222022",
"VRAC-20150116067",
"VRAC-20150116071",
"VRAC-20150116072",
"VRAC-20150116073",
"VRAC-20150116075",
"VRAC-20150116077",
"VRAC-20150116078",
"VRAC-20150116079",
"VRAC-20150122055",
"VRAC-20150122056",
"VRAC-20150122057",
"VRAC-20150122058",
"VRAC-20150122059",
"VRAC-20141223056",
"VRAC-20141223058",
"VRAC-20141223059",
"VRAC-20150126064",
"VRAC-20150126076",
"VRAC-20150126078",
"VRAC-20150126080",
"VRAC-20150121081",
"VRAC-20150121082",
"VRAC-20150121083",
"VRAC-20150121084",
"VRAC-20150122015",
"VRAC-20150122025",
"VRAC-20150122028",
"VRAC-20150122035",
"VRAC-20150121076",
"VRAC-20150121077",
"VRAC-20150121078",
"VRAC-20150121079",
"VRAC-20141222130",
"VRAC-20141222131",
"VRAC-20150122045",
"VRAC-20141223070",
"VRAC-20141223072",
"VRAC-20141223074",
"VRAC-20150121059",
"VRAC-20150123059",
"VRAC-20150121075",
"VRAC-20150123044",
"VRAC-20150123047",
"VRAC-20150123051",
"VRAC-20150123052",
"VRAC-20150123054",
"VRAC-20150123055",
"VRAC-20141222101",
"VRAC-20141222102",
"VRAC-20141222103",
"VRAC-20150130065",
"VRAC-20150130066",
"VRAC-20150126039",
"VRAC-20150126041",
"VRAC-20150126044",
"VRAC-20150126056",
"VRAC-20150126058",
"VRAC-20150126060"
        );
        $i = 1;
        $vracs = array("VRAC-20150119002");
        foreach ($vracs as $vracId) {
        	$vrac = VracClient::getInstance()->find($vracId);
        	$modif = clone $vrac;
        	$modif->version = 'M01';
    		$modif->date_stats = '2015-04-14T00:00:00+01:00';
    		$modif->commentaires = 'facturation 2015';
        	$modif->save(false);
        	$vrac->valide->statut = VracClient::STATUS_CONTRAT_ANNULE;
        	$vrac->save(false);
			$this->logSection('vrac', $modif->_id.' OK '.$i);
			$i++;
        }
    }

}